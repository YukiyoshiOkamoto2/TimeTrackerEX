# Automation TimeTracker Tool
![{87A0590B-B80A-4768-B253-858C2D2F45BC}](https://github.com/user-attachments/assets/458e4c28-413b-4495-b36f-ebfadc24d84f)

## 概要
TimeTrackerスケジュール自動入力ツール
勤務時間とOutlookのスケジュールからTimeTrackerへスケジュール登録します。

https://github.com/askul/trylion-customer-tools/releases<br>
こちらからダウンロードしてください。<br>
WIN用：at3-win.zip<br>
MAC用：at3-mac.zip<br>

ダウンロードしたフォルダを回答すると以下のファイルが展開されます。<br>
.data・・・・・・・・・永続データ保存用ディレクトリ<br>
at3.exeまたはat3・・・アプリケーション<br>
at3-update.exeまたはat3-update・・・アプリケーション更新用プログラム<br>

## 使い方

### 事前準備
始めに勤怠スケジュールとOutlookのスケジュールを取り込むための準備を実施してください。

- 勤怠スケジュール 取り込み準備
1. cwsにログイン
2. 就労管理→本人用メニュー→勤務実績入力（期間入力用）を表示
3. 印刷用表示を押下
4. PDFが開くのでローカルに保存（必ず拡張子は.pdf）
5. at3と同じディレクトリに配置

- Outlookのスケジュールを取り込む（WIN）

- Outlookのスケジュールを取り込む（MAC）

### 実行
at3をクリックまたはターミナル実行
※初回は設定項目の入力になります。以下を参考に入力してください。

## 設定項目の説明

このドキュメントでは、`settings.json` に定義されている設定項目について説明します。

---

### 設定項目一覧

#### 1. ユーザー名 (ログイン名)
- **キー**: `user_name`
- **必須**: はい
- **型**: 文字列
- **説明**: ログイン時に使用するユーザー名。

---

#### 2. TimeTrackerのベースURL
- **キー**: `base_url`
- **必須**: はい
- **型**: 文字列
- **説明**: TimeTrackerのベースとなるURL。

---

#### 3. プロジェクトID
- **キー**: `base_project_id`
- **必須**: はい
- **型**: 整数
- **説明**: プロジェクトを識別するためのID。

---

#### 4. 履歴からのスケジュール自動入力
- **キー**: `is_history_auto_input`
- **必須**: いいえ
- **型**: 真偽値
- **デフォルト**: `False`
- **説明**: 履歴を基にスケジュールを自動入力するかどうか。

---

#### 5. イベント時間の丸め方法
- **キー**: `rounding_time_type_of_event`
- **必須**: はい
- **型**: 文字列
- **デフォルト**: `nonduplicate`
- **選択肢**:
  - `backward`: 開始終了時間を切り上げる
  - `forward`: 開始終了時間を切り捨てる
  - `half`: 15分未満を切り捨てる、それ以外は切り上げる
  - `round`: 短くなるように丸める
  - `stretch`: 長くなるように丸める
  - `nonduplicate`: 重複しない場合は長く、重複する場合は短く丸める
- **説明**:  
  30分単位でのイベント時間の丸め方法を設定します。

**図解**
- **backward**:
  ```
  開始: 9:15 → 9:30
  終了: 17:45 → 18:00
  ```
- **forward**:
  ```
  開始: 9:15 → 9:00
  終了: 17:45 → 17:30
  ```
- **half**:
  ```
  開始: 9:15 → 9:30
  終了: 17:44 → 17:30
  ```
- **round**:
  ```
  開始: 10:15 → 10:30
  終了: 11:15 → 11:00
  ※開始・終了時間が同じ場合はイベントを削除
  ```
- **stretch**:
  ```
  開始: 10:15 → 10:00
  終了: 11:15 → 11:30
  ```
- **nonduplicate**:
  ```
  開始・終了時間が重複しない場合: 長くなるように丸める
  開始・終了時間が重複する場合: 短くなるように丸める
  ```

---

#### 6. 休暇イベントの設定
- **キー**: `time_off_event`
- **必須**: いいえ
- **型**: 辞書
- **説明**: 休暇イベントの設定を行います。
  - **イベント名**:
    - **キー**: `name_of_event`
    - **必須**: はい
    - **型**: 文字列リスト
    - **例**: `['有給', 'ランチ', '休暇']`
  - **WorkItemID**:
    - **キー**: `work_item_id`
    - **必須**: はい
    - **型**: 整数

---

#### 7. イベント重複時の優先判定
- **キー**: `event_duplicate_priority`
- **必須**: はい
- **型**: 辞書
- **説明**: イベントが重複した場合の優先度を設定します。
  - **時間の比較による優先度判定**:
    - **キー**: `time_compare`
    - **必須**: はい
    - **型**: 文字列
    - **デフォルト**: `small`
    - **選択肢**:
      - `small`: 時間が短いイベントを優先
      - `large`: 時間が長いイベントを優先

**図解**

これが・・・

![{E7F32652-6A47-4E1F-BBA1-47B488AEDD46}](https://github.com/user-attachments/assets/dc1fa74f-6cf3-4782-984e-cead02625bd6)

- **small**:

こうなります。

![{22DDF44B-1C8B-40B5-A668-2BA944024A23}](https://github.com/user-attachments/assets/e682251f-7fae-4f8b-8af6-d06b1d5da622)

- **large**:

 こうなります。
 
![{A734AD78-DF7C-40CF-A446-F07D5669155F}](https://github.com/user-attachments/assets/a3f1e0ef-7a57-4bbd-a099-bc5ff912f399)


---

#### 8. 勤務時間の自動入力設定
- **キー**: `schedule_auto_input_info`
- **必須**: はい
- **型**: 辞書
- **説明**: 勤務時間の自動入力設定を行います。
  - **開始終了時間の自動入力タイプ**:
    - **キー**: `start_end_type`
    - **必須**: はい
    - **型**: 文字列
    - **デフォルト**: `both`
    - **選択肢**:
      - `both`: 開始・終了時間を自動入力
      - `start`: 開始時間のみ自動入力
      - `end`: 終了時間のみ自動入力
      - `fill`: 開始・終了時間の間でイベントと重複しない時間を自動入力

---

#### 9. 有給休暇の自動入力設定
- **キー**: `paid_leave_input_info`
- **必須**: いいえ
- **型**: 辞書
- **説明**: 有給休暇の自動入力設定を行います。
  - **WorkItemID**:
    - **キー**: `work_item_id`
    - **必須**: はい
    - **型**: 整数
  - **開始時間**:
    - **キー**: `start_time`
    - **必須**: はい
    - **型**: 文字列
    - **デフォルト**: `09:00`
  - **終了時間**:
    - **キー**: `end_time`
    - **必須**: はい
    - **型**: 文字列
    - **デフォルト**: `17:30`


## 無視するイベントの設定

このドキュメントでは、`ignore.json` に定義されている設定項目について説明します。


### 概要
以下の設定を使用して、特定のイベントを無視することができます。

- **必須**: いいえ
- **型**: 配列
- **説明**: 無視するイベントのリストを設定します。例として、`定時退社日`などのイベントを指定できます。

例:
```json
[
  {
    "type": "event",
    "name": "定時退社日",
    "matchType": "contains"
  }
]
```

### フィールドの説明
- **type**: イベントの種類を指定します。`event`または`schedule`を指定可能です。
- **name**: イベント名を指定します。例: `定時退社日`。
- **matchType**: 名前の比較種類`contains（部分一致）`または`exact（完全一致）`を指定可能です。

---

## メモの生成
TimeTrackerへ登録時イベント毎にメモを挿入できます。

### 概要
`message_handler.py`を作成することで動的にメモを作成できます。
- **必須**: いいえ
- **型**: pythonファイル

#### 主な機能
- **動的ロード**: `message_handler.py` を動的にロードし、`get_message` 関数を使用可能にします。
- **メッセージ生成**: イベント、作業項目、コンテキストを基にメッセージを生成します。

```py
def get_message(event: dict, work_item: dict, context: dict) -> str:
    return None
```

#### event と workItem の説明

**event辞典**
`event` は作業項目を表現する辞典型です。

- **name**: イベント名。
- **organizer**: イベントの主催者。
- **working_event_type**: 勤務時間を示すタイプ、勤務時間から自動入力されたものを表します。（`start`, `middle`, `end` のいずれか）

**work_item**
`work_item` は作業項目を表現する辞典型です。

- **id**: 作業項目の一意の識別子。
- **name**: 作業項目の名前。
- **folder_name**: 作業項目が属するフォルダの名前。
- **folder_path**: 作業項目が属するフォルダのパス。
